---
title: "Sta 440 Case 3"
author: "Sreya Gnanavel, Yura Heo, Lily Seelig"
date: "September 2025"
format: 
  pdf:
    documentclass: article
    fontsize: 11pt
geometry: margin=1in
execute: 
  warning: false
  message: false
  echo: false
---

```{r}
#| label: load_packages

library(tidyverse)
library(lubridate)
library(janitor)    
library(scales)  

```

```{r}
#| label: data

load("emsData.RData")



glimpse(x)
ems <- x


```
```{r}
ems <- ems %>%
  mutate(
    mins_dispatch_to_enroute = as.numeric(timeToEnroute, units = "mins"),
    mins_enroute_to_arrival  = as.numeric(observedTT, units = "mins"),
    mins_dispatch_to_arrival = as.numeric(difftime(DT.ARRIVE, DT.DISP, units = "mins")),
    mins_on_scene            = as.numeric(onSceneDur, units = "mins"),
    mins_to_hospital         = as.numeric(toHospitalTT, units = "mins"),
    mins_turnaround          = as.numeric(difftime(DT.AVAILABLE, DT.ARVREC, units = "mins")),
    
    call_date = as_date(DT.DISP),
    dow       = wday(DT.DISP, label = TRUE, abbr = TRUE),
    hour      = hour(DT.DISP)
  )


# sanity check
ems %>%
  summarise(across(starts_with("mins_"), 
                   list(min = ~min(.x, na.rm = TRUE),
                        max = ~max(.x, na.rm = TRUE))))

```

```{r}
#| label: add scenario

ems <- ems %>%
  mutate(
    # S0 (Current: 3 Central, 1 South)
    resp_S0 = pmin(eTT.BG.Ce, eTT.BG.So, na.rm = TRUE),

    # S1 (3 Central, 1 Near North)
    resp_S1 = pmin(eTT.BG.Ce, eTT.BG.NN, na.rm = TRUE),

    # S2 (3 Central, 1 Far North)
    resp_S2 = pmin(eTT.BG.Ce, eTT.BG.FN, na.rm = TRUE),

    # S3 (2 Central, 1 South, 1 Near North)
    resp_S3 = pmin(eTT.BG.Ce, eTT.BG.So, eTT.BG.NN, na.rm = TRUE),

    # S4 (2 Central, 1 South, 1 Far North)
    resp_S4 = pmin(eTT.BG.Ce, eTT.BG.So, eTT.BG.FN, na.rm = TRUE)
  )
```

